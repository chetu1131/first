//controller 
  const express = require('express');
const router = express.Router();
const db = require('../config/database');

// GET notifications for a specific user
router.get('/notifications', async (req, res) => {
  const userId = req.user.id; // Assuming authenticated user's ID is available in req.user

  try {
    const notifications = await getNotifications(userId);
    res.render('notifications', { notifications });
  } catch (error) {
    console.error('Error fetching notifications:', error);
    res.status(500).send('Internal Server Error');
  }
});

// Fetch notifications from database
async function getNotifications(userId) {
  const sql = `
    SELECT n.*, u.username, t.content AS tweetContent
    FROM notifications n
    LEFT JOIN users u ON n.related_user_id = u.id
    LEFT JOIN tweets t ON n.tweet_id = t.id
    WHERE n.user_id = ?
    ORDER BY n.created_at DESC
  `;

  return new Promise((resolve, reject) => {
    db.query(sql, [userId], (err, results) => {
      if (err) {
        reject(err);
      } else {
        resolve(results);
      }
    });
  });
}

module.exports = router;

//ejs

<!-- notifications.ejs -->
<section class="w-3/5 border border-gray-200 max-w-screen-sm min-h-dvh">
  <div class="font-medium flex justify-around rounded-lg text-start p-8">
    <span class="mt-2 font-medium text-xl">Notification</span>
    <img
      class="p-1 w-10 h-10 rounded-full"
      src="/assets/notification.gif"
      alt="Bordered avatar"
    />
  </div>
  
  <% notifications.forEach(notification => { %>
    <div class="block w-full px-4 py-2 border-b border-gray-200 cursor-pointer hover:bg-gray-100 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-700 focus:text-blue-700">
      <div class="flex">
        <img
          class="w-10 h-10 p-1 rounded-full"
          src="<%= notification.avatarUrl %>"
          alt="Bordered avatar"
        />
        <div class="mt-2">
          <% if (notification.type === 'login') { %>
            There was a login to your account <%= notification.username %> from a new device on <%= notification.date %>. Review it now.
          <% } else if (notification.type === 'password_reset') { %>
            Your password was reset on your account. Based on this change, additional changes to your account may be restricted temporarily.
          <% } else if (notification.type === 'follow') { %>
            <%= notification.username %> followed you
          <% } else if (notification.type === 'like') { %>
            <img
              class="w-15 h-10 p-1 rounded-full"
              src="/assets/heart.png"
              alt="like icon"
            />
            <%= notification.username %> liked your Tweet
            <div class="mt-2"><%= notification.tweetContent %></div>
          <% } %>
        </div>
      </div>
    </div>
  <% }); %>

</section>
// front ens JavaScript 
  // frontend.js
document.addEventListener('DOMContentLoaded', () => {
  const loadNotifications = async () => {
    try {
      const response = await fetch('/notifications');
      const notifications = await response.json();
      
      // Assuming the notifications are returned as JSON from the backend
      const notificationsContainer = document.getElementById('allusercontent');
      notificationsContainer.innerHTML = ''; // Clear previous content

      notifications.forEach(notification => {
        const notificationDiv = document.createElement('div');
        notificationDiv.classList.add('block', 'w-full', 'px-4', 'py-2', 'border-b', 'border-gray-200', 'cursor-pointer', 'hover:bg-gray-100', 'hover:text-blue-700', 'focus:outline-none', 'focus:ring-2', 'focus:ring-blue-700', 'focus:text-blue-700');

        const content = `
          <div class="flex">
            <img class="w-10 h-10 p-1 rounded-full" src="${notification.avatarUrl}" alt="Bordered avatar" />
            <div class="mt-2">${notification.content}</div>
          </div>
        `;

        notificationDiv.innerHTML = content;
        notificationsContainer.appendChild(notificationDiv);
      });
    } catch (error) {
      console.error('Error loading notifications:', error);
    }
  };

  // Example: Trigger loading notifications when a button is clicked
  const allUserLink = document.getElementById('alluser');
  allUserLink.addEventListener('click', loadNotifications);
});







INSERT INTO countries (name) VALUES ('India');
INSERT INTO states (name, country_id) VALUES ('Gujarat', 1);
INSERT INTO cities (name, state_id) VALUES ('Surat', 1);
INSERT INTO roles (role_name) VALUES ('user');
INSERT INTO users (username, email, password, name, date_of_birth, country_id, state_id, city_id, role_id, is_active, is_private, is_varified)
VALUES ('john_doe', 'john@example.com', 'password123', 'John Doe', '1990-01-01', 1, 1, 1, 1, 1, 0, 0);
-- Assuming user_id = 1 (inserted user's ID) and role_id = 1 (assuming 'user' role)
INSERT INTO role_users (role_id, user_id) VALUES (1, 1);
INSERT INTO tweets (user_id, content, is_drafted, is_posted)
VALUES (1, 'Hello Twitter!', 0, 1);
-- Assuming user_id = 1 (inserted user's ID), tweet_id = 1 (inserted tweet's ID), related_user_id = 2 (another user's ID)
INSERT INTO notifications (user_id, tweet_id, type, related_user_id)
VALUES (1, 1, 'like', 2);
-- Assuming user_id = 1 (inserted user's ID) is following user_id = 2
INSERT INTO followers (following_id, follower_id, is_blocked, current_status)
VALUES (2, 1, 0, 1);
-- Assuming user_id = 1 (inserted user's ID) liked tweet_id = 1
INSERT INTO tweet_likes (user_id, tweet_id, status)
VALUES (1, 1, 1);
INSERT INTO tweet_comments (user_id, tweet_id, content)
VALUES (1, 1, 'This is a great tweet! Keep it up.');

-- Assuming user_id = 1 (inserted user's ID) liked comment_id = 1
INSERT INTO comment_likes (comment_id, user_id, status)
VALUES (1, 1, 1);
-- Assuming user_id = 1 (inserted user's ID) bookmarked tweet_id = 1
INSERT INTO bookmarks (tweet_id, user_id, status)
VALUES (1, 1, 1);
INSERT INTO hashtag_lists (hashtag_name)
VALUES ('technology');
-- Assuming hashtag_id = 1 (inserted hashtag's ID) is associated with tweet_id = 1
INSERT INTO hashtag_tweet (hashtag_id, tweet_id, status)
VALUES (1, 1, 1);
-- Assuming user_id = 1 (inserted user's ID) retweeted tweet_id = 1
INSERT INTO retweets (tweet_id, user_id, retweet_message)
VALUES (1, 1, 'Check this out!');
-- Assuming sender_id = 1 (inserted user's ID) sent a message to receiver_id = 2
INSERT INTO direct_messages (sender_id, receiver_id, content)
VALUES (1, 2, 'Hello, how are you?');



 SELECT n.*, u.username AS related_username, t.content AS tweet_content
      FROM notifications n
      LEFT JOIN users u ON n.related_user_id = u.id
      LEFT JOIN tweets t ON n.tweet_id = t.id
      WHERE n.user_id = 1
      ORDER BY n.created_at DESC;
